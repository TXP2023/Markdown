# P1314 [NOIP 2011 提高组] 聪明的质监员

## 题目描述

小 T 是一名质量监督员，最近负责检验一批矿产的质量。这批矿产共有 $n$ 个矿石，从 $1$ 到 $n$ 逐一编号，每个矿石都有自己的重量 $w_i$ 以及价值 $v_i$。检验矿产的流程是：

1. 给定 $m$ 个区间 $[l_i,r_i]$；
2. 选出一个参数 $W$；
3. 对于一个区间 $[l_i,r_i]$，计算矿石在这个区间上的检验值 $y_i$：

$$ y_i=\sum\limits_{j=l_i}^{r_i}[w_j \ge W] \times \sum\limits_{j=l_i}^{r_i}[w_j \ge W]v_j $$

其中 $j$ 为矿石编号，$[p]$ 是指示函数，若条件 $p$ 为真返回 $1$，否则返回 $0$。

这批矿产的检验结果 $y$ 为各个区间的检验值之和。即：$\sum\limits_{i=1}^m y_i$。

若这批矿产的检验结果与所给标准值 $s$ 相差太多，就需要再去检验另一批矿产。小 T 不想费时间去检验另一批矿产，所以他想通过调整参数 $W$ 的值，让检验结果尽可能的靠近标准值 $s$，即使得 $|s-y|$ 最小。请你帮忙求出这个最小值。

## 输入格式

第一行包含三个整数 $n,m,s$，分别表示矿石的个数、区间的个数和标准值。

接下来的 $n$ 行，每行两个整数，中间用空格隔开，第 $i+1$ 行表示 $i$ 号矿石的重量 $w_i$ 和价值 $v_i$。

接下来的 $m$ 行，表示区间，每行两个整数，中间用空格隔开，第 $i+n+1$ 行表示区间 $[l_i,r_i]$ 的两个端点 $l_i$ 和 $r_i$。注意：不同区间可能重合或相互重叠。

## 输出格式

一个整数，表示所求的最小值。

## 输入输出样例 #1

### 输入 #1

```
5 3 15 
1 5 
2 5 
3 5 
4 5 
5 5 
1 5 
2 4 
3 3
```

### 输出 #1

```
10
```

## 说明/提示

【输入输出样例说明】

当 $W$ 选 $4$ 的时候，三个区间上检验值分别为 $20,5,0$，这批矿产的检验结果为 $25$，此时与标准值 $S$ 相差最小为 $10$。

【数据范围】

对于 $10\%$ 的数据，有 $1 ≤n,m≤10$；

对于 $30\%$ 的数据，有 $1 ≤n,m≤500$；

对于 $50\%$ 的数据，有 $1 ≤n,m≤5,000$；
 
对于 $70\%$ 的数据，有 $1 ≤n,m≤10,000$；

对于 $100\%$ 的数据，有 $1 ≤n,m≤200,000$，$0 < w_i,v_i≤10^6$，$0 < s≤10^{12}$，$1 ≤l_i ≤r_i ≤n$

# 题目简述

有 $n$ 个石头， 每个石头有重量 $w_i$ 和价值 $v_i$, 

对于每次询问， 给定三个参数 $l_i, r_i, w_i$ 

询问的答案 $y_i = 为区间内重量大等于w的矿石数量 * 所有重量大等于w的矿石的价值和$

求一个 $w$ 使得 $\Sigma_{i=1}^{m} y_i$ 最小

首先， 计算每个矿石会出现多少次。记矿石 $i$ 出现的次数为 $cnt_i$ 使用线段树解决 $O((n+m)*log_2n)$ , 然后把每个涉及到的矿石存起来， 排序

构造前缀和 $Sum[i] = \Sigma_{i=1}^{n} cnt[i] * v_i$ 

那么，对于任意一个 $m$, 我们都可以以 $O(log_2n)$ 的复杂度计算出 $y$

二分枚举 $w$

分类讨论

$y == s$ 那么直接输出 0

$y > s$ 那么意味着满足条件的矿石太多了， 要减少 $w$

$y < s$ 那么意味着满足条件的矿石太少了， 要加大 $w$

我们记 $w$ 的范围为 $R$ 计算答案的复杂度为 $O(log_2R * log_2n)$