# 题目分解
给定一个长度为 $n$ 的序列 $A$，要将序列 $A$ 划分为诺干个子区间。对于每个子区间 $[l, r]$，要满足 $A_l = A_r$。规定合法的划分的贡献为
 
 $$\Sigma \Pi_{i=L_i}^{R_i}$$

求所有合法贡献之和

# slove

#### 子区间长度为1时

首先， 每个元素各位1个子区间，那么贡献就是 $\Pi_{i=1}^{n}A_i$

#### 子区间长度不为1时

首先，乘法是可以前缀和的，我们令 $mul_i = \Pi_{j=1}^{i}A_j$, 那么原公式可以转为

$$\Sigma \frac{mul_r}{mul_{l-1}}$$

现在尝试计算区间

建立一个 $last$ 数组，记录每个元素最后一次出现的次数, 一个 $preMul$ 数组，记录每个元素为区间端点的所有区间的积的和 , 同时建立数组 $f$,  令 $f_i$ 为数列的长度为 $i$ 的前缀子序列的所有方案的贡献和    

显然的 $f_1 = A_1$

如果 $i$ 不为 $1$ 时。$f_i$ 有2种选择, 第1种，此元素单独1个子区间， 第2种，此元素单独非个子区间， 记录 $cnt_i$ 为 $f_i$ 可行的方案数

显然的

$cnt_1 = 1$

第一种 $f_i = f_{i - 1} + A_i*cnt_{i - 1}$

第二种 $f_i = \Sigma f_{last_{A_i} - 1} + \frac{mul_i}{mul_{last_{A_i} - 1}}*cnt_{A_i}$

合并 
$$f_i = f_{i - 1} + A_i*cnt_{i - 1}+\Sigma (f_{last_{A_i} - 1} + \frac{mul_i}{mul_{last_{A_i} - 1}}*cnt_{last_{A_i} - 1})$$

$$cnt_i = cnt_{i - 1} + \Sigma cnt_{A_i - 1}$$

复杂度 $O(n^2)$ 


为什么没想出来正解？ 没有注意数据范围
